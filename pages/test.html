 <html>  
    <!--//this code by hongseheike-->  
    <head>  
    <script type="text/javascript" src="../js/xheditor/jquery/jquery-1.4.2.min.js"></script>
<script type="text/javascript" src="../js/xheditor/xheditor-1.1.9-zh-cn.min.js"></script>
    <script language="javascript">  
/*
$(pageInit); //xheditor init
function pageInit()
{
	$('#p_content').xheditor({upImgUrl:"protocol_image_upload.php",upImgExt:"jpg,jpeg,gif,png"});
}    
*/ 

    	var c;
      function keyDown(e) { 
      
      	if(typeof e == 'undefined') {  
            e = event;  
         } 
	
　　   　 var keycode = e.which;  
		
			
			if(keycode==8){ //8:backspace
				var cp=document.getElementById('p_content');
				var t=cp.value;

				var pos=getCursortPosition(cp);
	
				return t.charAt(pos-1);
				
			}
　　 　　    //var realkey = String.fromCharCode(e.which);  
　　 　　    //alert("按键码: " + keycode + " 字符: " + realkey);
　　  }
		function keyUp(e,c){
			if(typeof e == 'undefined') {  
            e = event;  
         } 
      		
　　   　 var keycode = e.which;  
		
			
			if(keycode==8){ //8:backspace
				var cp=document.getElementById('p_content');
				var t=cp.value;
				//alert(t);
				var pos=getCursortPosition(cp);
				
				cp.value=t.substring(0,pos)+"<del>"+c+"</del>"+t.substring(pos);
				
				setCaretPosition(cp,pos-1);
				
				cp.innerHTML=cp.value;
			}
		
		}
　　   //document.onkeydown = keyDown;

    function getCursortPosition (ctrl) {//获取光标位置函数
    	var CaretPos = 0;	// IE Support
    	if (document.selection) {
    	ctrl.focus ();
    		var Sel = document.selection.createRange ();
    		Sel.moveStart ('character', -ctrl.value.length);
    		CaretPos = Sel.text.length;
    	}
    	// Firefox support
    	else if (ctrl.selectionStart || ctrl.selectionStart == '0')
    		CaretPos = ctrl.selectionStart;
    	return (CaretPos);
    }
    
    function setCaretPosition(ctrl, pos){//设置光标位置函数
    	if(ctrl.setSelectionRange)
    	{
    		ctrl.focus();
    		ctrl.setSelectionRange(pos,pos);
    	}
    	else if (ctrl.createTextRange) {
    		var range = ctrl.createTextRange();
    		range.collapse(true);
    		range.moveEnd('character', pos);
    		range.moveStart('character', pos);
    		range.select();
    	}
    }




    </script>  
    </head>  
    <body> 
     
    //Javascript Document  
    <hr>  
    <center>  
    <h3>请按任意一个键。。。。</h3>  
    <textarea id="p_content" name="p_content" rows="12" style="width: 660px" onkeydown="c=keyDown(event);" onkeyup="keyUp(event,c)"></textarea>
    </center>  
    </body>  
    </html>  